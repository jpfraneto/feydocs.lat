"use client";
import {
  compareQuery,
  createAdapterProvider,
  createEmitter,
  debounceController,
  debug,
  error,
  globalThrottleQueue,
  renderQueryString
} from "./chunk-JUI2GJOM.js";
import {
  require_react
} from "./chunk-M5B3K67W.js";
import {
  __toESM
} from "./chunk-G3PMV62Z.js";

// node_modules/nuqs/dist/key-isolation-MD7HBc2w.js
function applyChange(newValue, keys, copy) {
  return (oldValue) => {
    if (!(keys.length === 0 ? true : keys.some((key) => !compareQuery(oldValue.getAll(key), newValue.getAll(key))))) {
      debug("[nuqs `%s`] no change, returning previous", keys.join(","), oldValue);
      return oldValue;
    }
    const filtered = filterSearchParams(newValue, keys, copy);
    debug(`[nuqs \`%s\`] subbed search params change
  from %O
  to   %O`, keys.join(","), oldValue, filtered);
    return filtered;
  };
}
function filterSearchParams(search, keys, copy) {
  if (keys.length === 0) return search;
  const filtered = copy ? new URLSearchParams(search) : search;
  for (const key of search.keys()) if (!keys.includes(key)) filtered.delete(key);
  return filtered;
}

// node_modules/nuqs/dist/reset-CKsIu3sM.js
var mutex = 0;
function spinQueueResetMutex() {
  mutex = Math.max(0, mutex - 1);
  if (mutex > 0) return;
  resetQueues();
}
function resetQueues() {
  debug("[nuqs] Aborting queues");
  debounceController.abortAll();
  globalThrottleQueue.abort().forEach((key) => debounceController.queuedQuerySync.emit(key));
}

// node_modules/nuqs/dist/patch-history-C8rMQUGm.js
var historyUpdateMarker = "__nuqs__";
function getSearchParams(url) {
  if (url instanceof URL) return url.searchParams;
  if (url.startsWith("?")) return new URLSearchParams(url);
  try {
    return new URL(url, location.origin).searchParams;
  } catch {
    return new URLSearchParams(url);
  }
}
function shouldPatchHistory(adapter) {
  if (typeof history === "undefined") return false;
  if (history.nuqs?.version && history.nuqs.version !== "0.0.0-inject-version-here") {
    console.error(error(409), history.nuqs.version, `0.0.0-inject-version-here`, adapter);
    return false;
  }
  if (history.nuqs?.adapters?.includes(adapter)) return false;
  return true;
}
function markHistoryAsPatched(adapter) {
  history.nuqs = history.nuqs ?? {
    version: "0.0.0-inject-version-here",
    adapters: []
  };
  history.nuqs.adapters.push(adapter);
}
function patchHistory(emitter2, adapter) {
  if (!shouldPatchHistory(adapter)) return;
  let lastSearchSeen = typeof location === "object" ? location.search : "";
  emitter2.on("update", (search) => {
    const searchString = search.toString();
    lastSearchSeen = searchString.length ? "?" + searchString : "";
  });
  window.addEventListener("popstate", () => {
    lastSearchSeen = location.search;
    resetQueues();
  });
  debug("[nuqs %s] Patching history (%s adapter)", "0.0.0-inject-version-here", adapter);
  function sync(url) {
    spinQueueResetMutex();
    try {
      if (new URL(url, location.origin).search === lastSearchSeen) return;
    } catch {
    }
    try {
      emitter2.emit("update", getSearchParams(url));
    } catch (e) {
      console.error(e);
    }
  }
  const originalPushState = history.pushState;
  const originalReplaceState = history.replaceState;
  history.pushState = function nuqs_pushState(state, marker, url) {
    originalPushState.call(history, state, "", url);
    if (url && marker !== historyUpdateMarker) sync(url);
  };
  history.replaceState = function nuqs_replaceState(state, marker, url) {
    originalReplaceState.call(history, state, "", url);
    if (url && marker !== historyUpdateMarker) sync(url);
  };
  markHistoryAsPatched(adapter);
}

// node_modules/nuqs/dist/adapters/react.js
var import_react = __toESM(require_react());
var emitter = createEmitter();
function generateUpdateUrlFn(fullPageNavigationOnShallowFalseUpdates) {
  return function updateUrl(search, options) {
    const url = new URL(location.href);
    url.search = renderQueryString(search);
    debug("[nuqs react] Updating url: %s", url);
    if (fullPageNavigationOnShallowFalseUpdates && options.shallow === false) (options.history === "push" ? location.assign : location.replace).call(location, url);
    else (options.history === "push" ? history.pushState : history.replaceState).call(history, history.state, historyUpdateMarker, url);
    emitter.emit("update", search);
    if (options.scroll === true) window.scrollTo({ top: 0 });
  };
}
var NuqsReactAdapterContext = (0, import_react.createContext)({ fullPageNavigationOnShallowFalseUpdates: false });
function useNuqsReactAdapter(watchKeys) {
  const { fullPageNavigationOnShallowFalseUpdates } = (0, import_react.useContext)(NuqsReactAdapterContext);
  const [searchParams, setSearchParams] = (0, import_react.useState)(() => {
    if (typeof location === "undefined") return new URLSearchParams();
    return filterSearchParams(new URLSearchParams(location.search), watchKeys, false);
  });
  (0, import_react.useEffect)(() => {
    const onPopState = () => {
      setSearchParams(applyChange(new URLSearchParams(location.search), watchKeys, false));
    };
    const onEmitterUpdate = (search) => {
      setSearchParams(applyChange(search, watchKeys, true));
    };
    emitter.on("update", onEmitterUpdate);
    window.addEventListener("popstate", onPopState);
    return () => {
      emitter.off("update", onEmitterUpdate);
      window.removeEventListener("popstate", onPopState);
    };
  }, [watchKeys.join("&")]);
  return {
    searchParams,
    updateUrl: (0, import_react.useMemo)(() => generateUpdateUrlFn(fullPageNavigationOnShallowFalseUpdates), [fullPageNavigationOnShallowFalseUpdates])
  };
}
var NuqsReactAdapter = createAdapterProvider(useNuqsReactAdapter);
function NuqsAdapter({ children, fullPageNavigationOnShallowFalseUpdates = false, ...adapterProps }) {
  return (0, import_react.createElement)(NuqsReactAdapterContext.Provider, { value: { fullPageNavigationOnShallowFalseUpdates } }, (0, import_react.createElement)(NuqsReactAdapter, {
    ...adapterProps,
    children
  }));
}
function enableHistorySync() {
  patchHistory(emitter, "react");
}
export {
  NuqsAdapter,
  enableHistorySync
};
//# sourceMappingURL=nuqs_adapters_react.js.map
